package com.example.asignyouaddress;import java.util.ArrayList;import java.util.List;import org.json.JSONException;import org.json.JSONObject;import com.baidu.android.pushservice.PushConstants;import com.baidu.android.pushservice.PushManager;import com.example.asignyouaddress.net.AsyncTaskUtil;import com.example.asignyouaddress.util.Content;import com.example.asignyouaddress.util.ValidateUtil;import com.webdesign688.emsd.R;import android.app.Activity;import android.content.Intent;import android.content.SharedPreferences;import android.content.pm.ActivityInfo;import android.os.Bundle;import android.os.Handler;import android.telephony.TelephonyManager;import android.text.TextUtils;import android.view.View;import android.view.Window;import android.view.WindowManager;import android.view.View.OnClickListener;import android.widget.Button;import android.widget.EditText;import android.widget.Toast;public class LoginActivity extends Activity {	private EditText edt_username;	private EditText edt_pwd;	private Button btn_login;	private com.example.asignyouaddress.view.ProgressDialog dialog;	@Override	protected void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		this.requestWindowFeature(Window.FEATURE_NO_TITLE);		setContentView(R.layout.login);	        PushManager.startWork(getApplicationContext(),PushConstants.LOGIN_TYPE_API_KEY,                Utils.getMetaValue(LoginActivity.this, "api_key"));        		init(); 			}	private void init() {		dialog =new com.example.asignyouaddress.view.ProgressDialog(LoginActivity.this);		edt_username = (EditText) findViewById(R.id.ui_username_input);		edt_pwd = (EditText) findViewById(R.id.ui_password_input);		btn_login = (Button) findViewById(R.id.ui_login_btn);		btn_login.setOnClickListener(listener);	}	OnClickListener listener =new OnClickListener() {				@Override		public void onClick(View v) {			switch (v.getId()) {			case R.id.ui_login_btn:				if (checkData() ){										initData();				}				break;			default:				break;			}					}	};	private String IMEI;	private String channeid;	private void initData(){	/*	Intent intent =new Intent(getApplicationContext(), SignActivity.class);		startActivity(intent);		finish();*/				SharedPreferences mySharedPreferences1 = getSharedPreferences(				"ASIGN", Activity.MODE_PRIVATE);				SharedPreferences.Editor editor1 = mySharedPreferences1				.edit();	   channeid =	mySharedPreferences1.getString("CHANNEID", "");        				TelephonyManager tm = (TelephonyManager) this				.getSystemService(TELEPHONY_SERVICE);		IMEI = tm.getDeviceId();	List<String> list = new ArrayList<String>();		list.add("UserName");		list.add("UserPwd");		list.add("ChannelID");		list.add("IMEI");		List<String> list1 = new ArrayList<String>();		list1.add(edt_username.getText().toString());		list1.add(edt_pwd.getText().toString());		list1.add(channeid);		list1.add(IMEI);		AsyncTaskUtil.getJson(list, list1, handler, dialog, Content.REGISTER,				LoginActivity.this, 3);			}	private Handler handler = new Handler() {		public void handleMessage(android.os.Message msg) {			switch (msg.what) {			case 1:				Toast.makeText(getApplicationContext(),						getResources().getString(R.string.toast11), 1).show();				break;			case 3:				String json = (String) msg.obj;				if (!TextUtils.isEmpty(json)) {					try {						JSONObject jRoot = new JSONObject(json);						int code = jRoot.getInt("code");						if (code == 1) {							String userID = jRoot.getJSONObject("data").getString("UserID");														SharedPreferences mySharedPreferences1 = getSharedPreferences(									"ASIGN", Activity.MODE_PRIVATE);							SharedPreferences.Editor editor1 = mySharedPreferences1									.edit();							editor1.putString("FLAG", 1+"");							editor1.putString("UserID", userID);							editor1.commit();							Intent intent =new Intent(getApplicationContext(), SignActivity.class);							startActivity(intent);							finish();						} else if (code == 0) {							// 跳转到注册界面							// startActivity(new Intent(getApplicationContext(),							// RegActivity.class));							String msg1 = jRoot.getString("msg");							Toast.makeText(getApplicationContext(), msg1, 0)									.show();																				}					} catch (JSONException e) {						// TODO Auto-generated catch block						e.printStackTrace();					}				}				break;			default:				break;			}		}	};	private boolean checkData() {		boolean checked = false;		checked = (!ValidateUtil.isEmpty(edt_username, getString(R.string.toasta)) && !ValidateUtil				.isEmpty(edt_pwd,  getString(R.string.toastb)));		return checked;	}}